---
date: 2015-12-26 14:44:30+00:00
layout: post
title: 文章编写
categories: 编写
tags:  记录
---

连接写法：

[我的主页](http://www.personalsite.cn/)
同样的是下载（目前没有这个文件没有）――[颜真卿楷书习字帖](/assets/颜真卿楷书习字帖.zip)

小标题：

Apple TV Media Explorer
=====

图片引用：

[![ ](/assets/1.jpg)](/assets/1.jpg)

文字加粗：

**下面的代码可以 HOOK 任意的函数（包括未导出的私有函数）**


代码：

  

    
    #include  #pragma comment (lib, "WiaGuid.lib")  int WINAPI WinMain(HINSTANCE hInstance, HINSTANCE hPrevInstance, LPSTR lpCmdLine, int nCmdShow) {     HRESULT hResult;     IWiaItem *pItemRoot;     IWiaDevMgr *pWiaDevMgr;      CoInitialize(NULL);      __try     {         // Create WIA Device Manager instance         pWiaDevMgr = NULL;         hResult = CoCreateInstance(CLSID_WiaDevMgr, NULL, CLSCTX_LOCAL_SERVER, IID_IWiaDevMgr, (void**) &pWiaDevMgr);         if (hResult != S_OK)         {             MessageBox(NULL, "Error: CoCreateInstance().", NULL, MB_ICONSTOP);             __leave;         }          // Display a WIA select device dialog         pItemRoot = NULL;         hResult = pWiaDevMgr->SelectDeviceDlg(NULL, 0, WIA_SELECT_DEVICE_NODEFAULT, NULL, &pItemRoot);          // User canceled         if (hResult == S_FALSE)         {             MessageBox(NULL, "User canceled.", NULL, MB_ICONINFORMATION);             __leave;         }         // No device available         else if (hResult == WIA_S_NO_DEVICE_AVAILABLE)         {             MessageBox(NULL, "No device available.", NULL, MB_ICONINFORMATION);             __leave;         }          // OK, Then ..........      }     __finally     {         // Release COM interface.         if (pItemRoot)             pItemRoot->Release();          if (pWiaDevMgr)             pWiaDevMgr->Release();          CoUninitialize();     }     return 0; }

注意需要缩进

{% highlight cpp linenos %}

NS_INLINE uint8_t *ModuleBase(NSString *path, NSString *refFunc, unsigned int refAddr = 0x1000)
{
	unsigned char *base = (unsigned char *)dlsym(dlopen(path.UTF8String, RTLD_LAZY), refFunc.UTF8String);
	if (base == nil)
	{
		_Log(@"HOOK Base symbol not found");
		return nil;
	}
	
	if (((unsigned int)base & 0x0FF0) != (refAddr & 0x0FF0))
	{
		_Log(@"HOOK Base symbol miss match: %p !=! %08X", base, refAddr);
		return nil;
	}
	
	base -= refAddr;
	_Log(@"HOOK Base: %@ at %p", path, base);
	return base;
}
{% endhighlight %}


